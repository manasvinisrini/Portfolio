---
layout: page
title: Inverted Pendulum
subtitle: Northwestern University&#58; Winter Project
---
	<h3>Technical Skills</h3>
	<ul>
		<li>ROS</li>
		<li>Python (including Pyserial)</li>
    <li>Robotic Manipulation</li>
		<li>Constrained Inverse Kinematics and Jacobians</li>
    <li>Microduino <a href="http://wiki.microduinoinc.com/Microduino-Module_CoreUSB"target="_blank">CoreUSB</a>, <a href="http://wiki.microduinoinc.com/Microduino-Module_Motion"target="_blank">Motion Sensor</a>, and <a href="http://wiki.microduinoinc.com/Microduino-Module_BM_Li-ion"target="_blank">Battery Management</a> Modules</li>
    <li><a href="https://learn.sparkfun.com/tutorials/using-the-bluesmirf"target="_blank">BlueSmirf</a> Bluetooth Module &amp; Serial Communication</li>
    <li>LQR Control</li>
    <li>Euler-Lagrange Equations with External Forces</li>
    <li>Mathematica Simulation</li>
    <li>MATLAB</li>
    <li>Solid Modeling &amp; 3D Printing</li>
	</ul>
	<hr/>
  <h3>Introduction</h3>
  <p>The objective of this project was to use Sawyer to stably balance a two-degree-of-freedom pendulum. Specifically, the pendulum can only rotate freely along a revolute joint in the 'x-z plane' formed by Sawyer's end effector (Figure 1). Achieving that goal, the next two goals were to keep the pendulum balancing even with a force disturbance and to balance it at a specific location along the straight line path. To accomplish this, four main tasks were involved:</p>
  <figure style= "float: right; width: 30%; margin-left: 2%; font-style: italic">
    <img src="images/sawyerEE.png" style="width: 100%;">
    <p>Figure 1: Sawyer's end effector and body frames</p>
  </figure>
  <ul>
    <li>Calculation of the equations of motion and deriving a Linear Quadratic Regulator (LQR) Controller from them</li>
    <li>Designing a custom inverse kinematics solver to move Sawyer's end effector along a straight line</li>
    <li>Becoming familiar with the CoreUSB, Motion Sensor, and Battery Management Microduino modules along with the BlueSmirf Bluetooth unit so that angle data could be sent wirelessly from the tip of the pendulum to a laptop</li>
    <li>Solid modeling the attachment to Sawyer's end effector, the pendulum holder, and the Microduino housing for the top of the pendulum and 3D printing them</li>
  </ul>
  <h3>I - Part 1: System Dynamics</h3>
  <p>Assuming a coordinate system where \(x\) corresponds to the position of Sawyer's end effector (positive is to the right), and \(\theta\) corresponds to the angular position (positive is clockwise) of the pendulum, the equations of motion with an external force, \(F\), are as follows:
    $$ (m+M)\ddot x + \ddot\theta mL cos \theta - \dot\theta^2 mLsin \theta = F \qquad \Rightarrow \qquad \ddot x = \frac{F+mL(\dot\theta^2\sin\theta-\ddot\theta\cos\theta)}{M+m} $$ $$ \ddot x \cos\theta + \ddot\theta L -g \sin\theta = 0 \qquad \Rightarrow \qquad \ddot\theta = \frac{g\sin\theta-\ddot x \cos\theta}{L} $$ where \(m\) is the mass at the pendulum tip, \(M\) is the mass of Sawyer's end effector, \(g\) is gravity, and \(L\) is the length of the pendulum. A complete derivation of these equations can be found <a href="https://www.youtube.com/watch?v=7Tvo8jXlPuk"target="_blank">here</a>. However, the video assumes positive as counterclockwise. Also, the equations here and in the video assume the mass of the pendulum shaft to be negligible and that energy is conserved. A simulation of the inverted pendulum system when \(F = 0\) for some arbitrary values of \(M\),\(m\), and \(L\) can be seen in Figure 2.</p>
  <figure style="font-style: italic; float: left; width: 32%; margin-left: 1%; margin-right: 1%; margin-bottom: 0.5em;">
    <img src="images/pure_dynamics2.gif" style= "width: 100%;">
    <p>Figure 2: Simulation of regular equations of motion</p>
  </figure>
  <figure style="font-style: italic; float: left; width: 32%; margin-bottom: 0.5em;">
    <img src="images/half_dynamics2.gif" style = "width: 100%;">
    <p>Figure 3: Simulation ignoring the dynamics of the 'cart'</p>
  </figure>
  <figure style="font-style: italic; float: left; width: 32%; margin-right: 1%; margin-left: 1%; margin-bottom: 0.5em;">
    <img src="images/control.gif" style= "width: 100%;">
    <p>Figure 4: Simulation of acceleration control</p>
  </figure>
    <p style="clear: both;">Figure 2 suggests that with the right feedback, it would be possible to balance the pendulum with an external control force. However, while it is true that Sawyer is equipped with series-elastic actuators that allow forces to be measured (via spring deflections), there are some nonlinearities associated with the measurements that make using force control unreliable. To that effect, I made the decision to work with velocity feedback control. This required a change to the equations of motion. Fortunately, it can be assumed that the motion of the pendulum will have negligible effect on Sawyer's end effector position. In other words, it can be assumed that if Sawyer's end effector is commanded to move at a specific rate, it will do so regardless of the pendulum's motion. Thus, the equations of motion can become: $$ \ddot x = u $$ $$ \ddot\theta = \frac{g\sin\theta-u \cos\theta}{L} $$ where \(u\) is the control input. This characterises acceleration control. When the control input is zero, the pendulum is free to swing, but the base (red block in the figures above) does not move (Figure 3). However, with a good control method (look at the section below), \(u\) can be integrated and used as velocity control. It is also interesting to note that the equations above only depend on the length of the pendulum shaft. The longer the shaft, the lower the angular acceleration and the easier it is to control.
    </p>
  <h3>I - Part 2: Control Algorithm</h3>
  <p>To set up the LQR controller, the equations of motion had to first be linearized. To do this, small angle approximation was performed so that \(\sin\theta \approx \theta\) and \(\cos\theta \approx 1\). Thus, the linearized equations of motion are: $$ \ddot x = u $$ $$ \ddot\theta = \frac{g\theta-u}{L} $$ Converting this to state space where the four states are \(x\) - end effector position, \(\dot x\) - end effector velocity, \(\theta\) - pendulum tilt, and \(\dot\theta\) - pendulum angular velocity, the following A &amp; matrices are developed: $$ \dot x = \begin{bmatrix} \dot x \\ \ddot x \\ \dot \theta \\ \ddot \theta \end{bmatrix} = \begin{bmatrix} 0 & 1 & 0 & 0 \\ 0 & 0 & 0 & 0 \\ 0 & 0 & 0 & 1 \\ 0 & 0 & \frac{g}{L} & 0 \\ \end{bmatrix} \begin{bmatrix} x \\ \dot x \\ \theta \\ \dot \theta \\ \end{bmatrix} + \begin{bmatrix} 0 \\ 1 \\ 0 \\ -\frac{1}{L} \end{bmatrix}u $$ After some tuning, the cost matrices for Q and R that gave good results were: $$ Q = \begin{bmatrix} .3 & 0 & 0 & 0 \\ 0 & .001 & 0 & 0 \\ 0 & 0 & 100 & 0 \\ 0 & 0 & 0 & .1 \\ \end{bmatrix} \qquad \qquad \qquad R = \begin{bmatrix} 1 \\ \end{bmatrix} $$
   </p>
  <h3>Short Summary</h3>
	<p>In the video below, Sawyer moves his arm to keep the pendulum from tipping over. In the beginning, it is easy to see how the system remains stable when no external disturbance is taking place. In the second part, the pendulum shaft is pushed with another wooden dowel two times. The first time is a light push which Sawyer is able to recover from pretty well. The second time is a harder push, but Sawyer still manages to recover nicely. Finally, at the end of the video, one can see how the shaft tips over when the control output is turned off. </p>
	<p> To learn more about the project, click <a href="https://github.com/swiz23/inverted_pendulum"target="_blank">here</a> to see the GitHub repo and access the README.</p>
	<hr />

	<h3>Demo Video</h3>
	<!-- <iframe width="420" height="315" src=""></iframe> -->
	<iframe src="https://drive.google.com/file/d/1FXJXsdRcDxJXS-Kua1aB4rFsKBY5Y83M/preview" width="1024" height="576" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
